---
import Base from '../../layouts/Base.astro'
import groq from 'groq'
import { sanity } from '../../lib/sanity'
import SanityImage from '../../components/SanityImage.astro'

// If you want to show only posts in the "Guides" category, use the filtered GROQ below.
// const posts = await sanity.fetch(groq`*[_type=="post" && references(*[_type=="category" && title=="Guides"]._id)] | order(publishedAt desc){title,"slug":slug.current,excerpt,mainImage,publishedAt}`)

const posts = await sanity.fetch(groq`
  *[_type=="post"] | order(publishedAt desc)[0...50]{
    title, "slug": slug.current, excerpt, mainImage, publishedAt
  }
`)
---
<Base title="Guides" description="Plain-English crypto guides you can trust.">
  <h1 class="text-3xl sm:text-4xl font-semibold">Guides</h1>
  <div class="grid sm:grid-cols-2 gap-4 mt-4">
    {posts.map((p:any) => (
      <a href={`/guides/${p.slug}/`} class="rounded-2xl p-4 border border-white/5 bg-[#12161b] block">
        {p.mainImage && (
          <SanityImage asset={p.mainImage} alt={p.title}
            widths={[480,640,800]} sizes="(max-width: 768px) 100vw, 480px"
            class="w-full h-40 object-cover rounded-lg" />
        )}
        <div class="mt-3">
          <h2 class="font-semibold">{p.title}</h2>
          {p.excerpt && <p class="opacity-70 text-sm mt-1">{p.excerpt}</p>}
          <p class="opacity-60 text-xs mt-1">{p.publishedAt && new Date(p.publishedAt).toLocaleDateString()}</p>
        </div>
      </a>
    ))}
  </div>
</Base>
