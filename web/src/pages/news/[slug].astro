---
import groq from 'groq'
import { sanity } from '../../lib/sanity'
import { toHTML } from '@portabletext/to-html'
import Base from '../../layouts/Base.astro'
import SanityImage from '../../components/SanityImage.astro'

export async function getStaticPaths() {
  const slugs = await sanity.fetch(
    groq`*[_type=="post" && defined(slug.current)][].slug.current`
  )
  return slugs.map((slug: string) => ({ params: { slug } }))
}

const { slug } = Astro.params
const post = await sanity.fetch(
  groq`*[_type=="post" && slug.current==$slug][0]{
    title, coverImage, publishedAt, body
  }`,
  { slug }
)

const bodyHtml = post?.body ? toHTML(post.body) : ''
---
<Base title={post?.title} description={post?.title}>
  <a href="/news/" class="text-white/80 hover:text-white">‚Üê All News</a>
  <h1 class="text-3xl font-semibold mt-2">{post?.title}</h1>
  <p class="opacity-70 text-sm">{new Date(post?.publishedAt).toLocaleString()}</p>

  {post?.coverImage && (
    <SanityImage
      asset={post.coverImage}
      alt={post?.title}
      widths={[640,800,1200,1600]}
      sizes="(max-width: 768px) 100vw, 1200px"
      loading="eager"
      fetchpriority="high"
      aspect={1200/630}
      class="rounded-2xl my-4"
    />
  )}

  <div class="prose prose-invert max-w-none" set:html={bodyHtml}></div>
</Base>
