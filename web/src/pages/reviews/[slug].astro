---
import Base from '../../layouts/Base.astro'
import groq from 'groq'
import { sanity } from '../../lib/sanity'
import SanityImage from '../../components/SanityImage.astro'

export async function getStaticPaths() {
  const slugs = await sanity.fetch(
    groq`*[_type=="exchange" && defined(slug.current)][].slug.current`
  )
  return slugs.map((slug: string) => ({ params: { slug } }))
}

const { slug } = Astro.params
const x = await sanity.fetch(
  groq`*[_type=="exchange" && slug.current==$slug][0]{
    name, logo, shortDescription, websiteUrl, tradingFees, proofOfReserves, scores, pros, cons, body, publishedAt
  }`,
  { slug }
)
---
<Base title={`${x?.name} Review`} description={x?.shortDescription}>
  <a href="/reviews/" class="text-white/80 hover:text-white">← All Reviews</a>
  <div class="flex items-center gap-3 mt-2">
    {x?.logo && <SanityImage asset={x.logo} alt={`${x.name} logo`} widths={[80,160,240]} sizes="80px" aspect={1} class="rounded-lg" />}
    <h1 class="text-3xl font-semibold">{x?.name} Review</h1>
  </div>
  <p class="opacity-70 mt-2">{x?.shortDescription}</p>
  <ul class="mt-4 grid grid-cols-2 gap-3 text-sm">
    <li><span class="opacity-70">Maker:</span> {x?.tradingFees?.maker ?? '—'}%</li>
    <li><span class="opacity-70">Taker:</span> {x?.tradingFees?.taker ?? '—'}%</li>
    <li><span class="opacity-70">Proof of Reserves:</span> {x?.proofOfReserves ? 'Yes' : 'No'}</li>
    <li><span class="opacity-70">Scores:</span> Overall {x?.scores?.overall ?? '—'} / Fees {x?.scores?.fees ?? '—'} / Security {x?.scores?.security ?? '—'} / UX {x?.scores?.ux ?? '—'}</li>
  </ul>
  {x?.websiteUrl && <p class="mt-3"><a class="underline" href={x.websiteUrl} rel="noopener" target="_blank">Visit website</a></p>}
</Base>
