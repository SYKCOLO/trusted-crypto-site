---
import Base from '../layouts/Base.astro'
import groq from 'groq'
import { sanity } from '../lib/sanity'
import SanityImage from '../components/SanityImage.astro'
import GlowBG from '../components/GlowBG.astro'

const [exchanges, posts] = await Promise.all([
  sanity.fetch(groq`
    *[_type=="exchange"] | order(scores.overall desc)[0...4]{
      name, "slug": slug.current, logo, shortDescription,
      "overall": scores.overall, "maker": tradingFees.maker, "taker": tradingFees.taker, proofOfReserves
    }
  `),
  sanity.fetch(groq`
    *[_type=="post"] | order(publishedAt desc)[0...4]{
      title, "slug": slug.current, "coverImage": coalesce(mainImage, coverImage), publishedAt
    }
  `),
])

const title = 'Make smarter crypto decisions with independent reviews & simple guides'
const description = 'We test exchanges and tools, explain the trade-offs in plain English, and keep rankings honest.'
---
<Base {title} {description} url="https://trustedcrypto.com/">
  <!-- HERO with soft blurred glow -->
  <section class="relative overflow-hidden rounded-3xl border border-white/10 bg-white/5 p-6 sm:p-10">
    <GlowBG />
    <h1 class="text-3xl sm:text-4xl font-semibold leading-tight max-w-3xl">{title}</h1>
    <p class="opacity-80 mt-3 max-w-2xl">{description}</p>

    <!-- CTA row -->
    <div class="mt-5 flex flex-wrap gap-3">
      <a href="/best-exchanges/" class="px-4 py-2 rounded-xl bg-white text-black hover:opacity-90">See top exchanges</a>
      <a href="/news/" class="px-4 py-2 rounded-xl border border-white/20 hover:bg-white/5">Read latest</a>
    </div>

    <!-- Quick deep-link chips -->
    <div class="mt-4 flex flex-wrap gap-2">
      <a href="/best-exchanges/" class="text-sm px-3 py-1.5 rounded-full bg-white/10 border border-white/10 hover:bg-white/15">Best overall</a>
      <a href="/best-exchanges/" class="text-sm px-3 py-1.5 rounded-full bg-white/10 border border-white/10 hover:bg-white/15">Low fees</a>
      <a href="/best-exchanges/" class="text-sm px-3 py-1.5 rounded-full bg-white/10 border border-white/10 hover:bg-white/15">For beginners</a>
      <a href="/reviews/"        class="text-sm px-3 py-1.5 rounded-full bg-white/10 border border-white/10 hover:bg-white/15">All reviews</a>
    </div>
  </section>

  <!-- VALUE PROPS -->
  <section class="mt-10 grid sm:grid-cols-3 gap-4">
    <div class="rounded-2xl p-5 border border-white/10 bg-white/5">
      <div class="text-lg font-semibold">Independent testing</div>
      <p class="opacity-80 mt-1 text-sm">Transparent criteria. No pay-to-play. We publish methods and updates.</p>
    </div>
    <div class="rounded-2xl p-5 border border-white/10 bg-white/5">
      <div class="text-lg font-semibold">Plain-English guidance</div>
      <p class="opacity-80 mt-1 text-sm">Cut the jargon. Understand trade-offs in minutes, not hours.</p>
    </div>
    <div class="rounded-2xl p-5 border border-white/10 bg-white/5">
      <div class="text-lg font-semibold">Built for speed</div>
      <p class="opacity-80 mt-1 text-sm">Optimized for Core Web Vitals so pages load fast everywhere.</p>
    </div>
  </section>

  <!-- TOP EXCHANGES -->
  <section class="mt-10">
    <div class="flex items-baseline justify-between">
      <h2 class="text-2xl font-semibold">Top exchanges</h2>
      <a class="text-sm underline opacity-80 hover:opacity-100" href="/best-exchanges/">View all</a>
    </div>
    <div class="grid sm:grid-cols-2 gap-4 mt-3">
      {exchanges.map((x:any) => (
        <a href={`/reviews/${x.slug}/`} class="bg-[#12161b] rounded-2xl p-5 border border-white/5 block">
          <div class="flex items-center gap-3">
            <div class="w-16 h-16 rounded-lg bg-white/5 grid place-items-center overflow-hidden">
              {x.logo && <SanityImage asset={x.logo} alt={`${x.name} logo`} widths={[64,96,128,160]} sizes="64px" class="w-14 h-14 object-contain" />}
            </div>
            <div>
              <div class="font-semibold">{x.name}</div>
              <div class="text-sm opacity-70">Overall {x.overall ?? '—'} • Fees {x.maker ?? '—'}/{x.taker ?? '—'}% {x.proofOfReserves ? '• PoR' : ''}</div>
            </div>
          </div>
          <p class="opacity-80 mt-3">{x.shortDescription}</p>
        </a>
      ))}
    </div>
  </section>

  <!-- LATEST POSTS -->
  <section class="mt-10">
    <div class="flex items-baseline justify-between">
      <h2 class="text-2xl font-semibold">Latest guides & news</h2>
      <a class="text-sm underline opacity-80 hover:opacity-100" href="/news/">View all</a>
    </div>
    <div class="grid sm:grid-cols-2 gap-4 mt-3">
      {posts.map((p:any) => (
        <a href={`/news/${p.slug}/`} class="rounded-2xl p-4 border border-white/5 bg-[#12161b] block">
          {p.coverImage && (
            <SanityImage asset={p.coverImage} alt={p.title}
              widths={[480,640,800]} sizes="(max-width: 768px) 100vw, 480px"
              class="w-full h-40 object-cover rounded-lg" />
          )}
          <div class="mt-3">
            <h3 class="font-semibold">{p.title}</h3>
            <p class="opacity-70 text-sm mt-1">{new Date(p.publishedAt).toLocaleDateString()}</p>
          </div>
        </a>
      ))}
    </div>
  </section>

  <!-- TRUST BAR (placeholder logos/text) -->
  <section class="mt-10 rounded-2xl p-6 border border-white/10 bg-white/5">
    <p class="opacity-70 text-sm">As featured by</p>
    <div class="flex flex-wrap gap-x-6 gap-y-3 mt-3 opacity-80">
      <span>BBC</span><span>CNN</span><span>Reuters</span><span>Bloomberg</span><span>WSJ</span><span>Time</span>
    </div>
  </section>

  <!-- FOOTER CTA -->
  <section class="mt-10 rounded-2xl p-6 border border-white/10 bg-white/5">
    <h2 class="text-xl font-semibold">What should we test next?</h2>
    <p class="opacity-80 mt-1">Tell us the tools and exchanges you want to see reviewed.</p>
    <a class="inline-block mt-3 underline" href="mailto:hello@trustedcrypto.com">hello@trustedcrypto.com</a>
  </section>
</Base>
