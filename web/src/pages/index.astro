---
export const prerender = false; // ensure SSR so cookies & query work

import ComingSoon from './coming-soon.astro'
import HomeHP from '../partials/HomeHP.astro'

const url = new URL(Astro.request.url)          // stable across Astro versions
const hasCookie = Astro.cookies.get('tc-preview')?.value === '1'
const qaParam  = url.searchParams.get('qa') === '1'

if (qaParam && !hasCookie) {
  Astro.cookies.set('tc-preview', '1', {
    path: '/',
    httpOnly: true,
    sameSite: 'Lax',
    maxAge: 60 * 60 * 12, // 12h
  })
}

const showFullHP = hasCookie || qaParam
---
{ showFullHP ? <HomeHP /> : <ComingSoon /> }
